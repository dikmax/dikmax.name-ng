---
title: "И снова Dart"
date: "2014-02-22T12:40:00+03:00"
published: true
tags: "dart, блог, программирование"
thread: 2302262951
---

![](/images/3rd-party/dart-logo.png "Dart")

С\ некоторыми перерывами я\ [перевёл][old-post] весь свой клиентский код на\ [Dart]. Кроме того, я\ стал использовать
Dart для воплощения других своих идей и\ даже успел отправить пару патчей разработчикам одной из\ библиотек. В\ связи
с\ этим делюсь некоторым количеством впечатлений от\ языка.

1. Поддержка Dart в\ [продуктах JetBrains][webstorm] просто отличная. Писать на\ Dart гораздо удобнее, чем
    на\ JavaScript, а\ ведь плагин для JavaScript разрабатывается и\ улучшается намного дольше. И\ всё это из-за
    более строгой структуры языка. Она позволяет IDE лучше просчитывать зависимости и\ в\ нужное время дополнять
    необходимые конструкции. Но\ не\ обошлось без ложки дёгтя. Иногда плагин просто перестаёт дополнять что\ бы
    то\ ни\ было, спасает только перезагрузка среды. И\ ещё не\ хватает привычных intentions, вроде склеить два `if`
    в\ один или заменить одинарные кавычки на\ двойные, но\ я\ думаю, что это будет реализовано со\ временем.

2. В\ Dart есть приватные члены класса, но\ нет зарезервированного слова `private`. Всё потому, что все идентификаторы,
    начинающиеся с\ подчёркивания (`_`), считаются приватными. И\ это правильно.

3. Видно, что язык разрабатывался с\ учётом опыта создания сложных приложений. Например, я\ нигде больше не\ встречал
    поддержки [factory-конструкторов][factory] на\ уровне языка.

    ~~~~~dart
    class Singleton {
      static final Singleton _singleton = new Singleton._internal();
      factory Singleton() {
        return _singleton;
      }
      Singleton._internal();
    }

    var singleton = new Singleton();
    ~~~~~

    В\ этом\ же примере можно видеть ещё одну особенность Dart: именованные конструкторы. Так как в\ динамическом языке
    нельзя сделать перегрузку методов по\ типам параметров, то\ для конструкторов авторы решили добавить возможность
    выбора конструктора по\ имени. А\ для остальных случаев вполне хватает именованных необязательных параметров.

4. В\ языке довольно много различного синтаксического сахара: тот\ же cascade operator (`..`). Крайне удобная штука для
    работы с\ DOM и\ стилями.

    ~~~~~dart
    element.style
      ..visibility = 'visible'
      ..display = 'block';
    ~~~~~

5. Ещё прекрасно сделана подстановка значений переменных и\ выражений в\ строку. Это выглядит частью языка,
    а\ не\ afterthought, как, например, в\ PHP.

    ~~~~~dart
    previousLink.attributes['title'] += ' (${isMac ? '⌥←' : 'Ctrl + ←'})';
    ~~~~~

    Обращаем внимание на\ то, что внутри `${...}` может быть любое выражение точно в\ таком же виде, в\ каком вы\ бы его
    увидели и\ без строки. Кавычки внутри выражения не\ закрывают строку, и\ их\ не\ нужно экранировать, что вполне
    логично, но\ в\ том\ же PHP этого нет.

6. Dart\ --- язык с\ необязательной типизацией. То есть если хочешь, можно указать тип переменной, а\ можно просто
    написать `var` и\ не париться. Всё это будет работать до\ тех пор, пока не\ попадётся, например, функция
    с\ указанным типом параметров. Вот тут-то тип твоей переменной будет проверен. И\ будет выведена ошибка, если
    типы не\ совпадают. Но\ когда вместо `var` указываешь реальный тип переменной, то\ проверки происходят гораздо чаще,
    буквально в\ каждом операторе, везде, где может возникнуть несовместимость типов.

    Кроме того, в\ Dart нет неявного приведения типов. Например, вот этот код выведет сообщение об\ ошибке потому, что
    нельзя просто так привести строку к\ булевому значению:

    ~~~~~dart
    String str = '';
    if (!str) {
      // do something
    }
    ~~~~~

    Но\ не\ стоит особо волноваться: о\ большинстве потенциальных проблем статический анализатор языка (то есть IDE)
    сообщит заранее.

    Все эти проверки работают в\ так называемом “checked mode”. Чтобы этот режим включить, виртуальная машина должна
    быть запущена со\ специальным параметром, например:

    ~~~~~bash
    dart --checked main.dart
    ~~~~~

    Или в\ случае с\ сайтом сам браузер нужно запускать так (пример для Linux):

    ~~~~~bash
    DART_FLAGS='--checked' ./chrome
    ~~~~~

    Если этого не\ сделать, то\ виртуальная машина будет работать в\ production-режиме и\ ни\ одной дополнительной
    проверки не будет сделано. Зато выполняться скрипт будет очень быстро! Поэтому можно думать о\ типах, как
    об\ автоматических инструкциях `assert` в\ языке в\ помощь разработчику. Кстати, просто `assert` тоже присутствует
    и\ тоже не\ работает в\ production-режиме.

    А\ ещё в\ Dart есть [Generics]. И\ это позволяет создавать весьма сложные зависимости типов и\ опять\ же проверки.
    К\ сожалению, Generics можно применить только к\ классам, может, в\ будущем добавят поддержку отдельных функций.

    ~~~~~dart
    class ParseContext<S extends Iterable> {
      final S source;

      // More definitions
    }
    ~~~~~

7. Переопределение операторов. Не\ думаю, что нужно рассказывать про плюсы и\ минусы этого решения. Все, кто
    когда-либо сталкивался с\ ними в\ любом другом языке, и\ так о\ них знают. Динамический Dart может добавить
    к\ этому ещё немного проблем. И\ хотелось\ бы иметь возможность создания произвольных операторов, как в\ Haskell.
    Было\ бы круто.

8. Из\ недостатков можно выделить то, что интерфейсы визуально не\ отличаются от\ классов. То\ есть нет
    зарезивированного слова `interface`, вместо него используется тот\ же `class`. Но\ при этом есть слова и\ `extends`,
    и\ `implements`.  Всё различие заключается в\ том, что может присутствовать в\ классе, но\ не\ может присутствовать
    в\ интерфейсе, и\ наоборот. К\ примеру, в\ интерфейсе может быть factory-конструктор, который будет возвращать
    реализацию этого интерфейса по-умолчанию. Но\ в\ этом случае не\ получится унаследоваться от\ такого
    интерфейса при помощи `extends`. Компилятор выдаст “The generative constructor expected, but factory found”. А\ это
    не\ особо очевидно, особенно когда видишь это сообщение первый раз.

9. Ещё один минус\ --- размер js-файла на\ выходе. Пока не\ у\ всех есть браузер с\ нативной поддержкой Dart,
    и\ многим придётся загружать сконвертированный код.  Ладно, будем честными: браузера пока ни\ у\ кого нет, кроме
    разработчиков, которые на\ Dart пишут (он\ называется [Dartium], его можно [скачать на\ сайте
    проекта][dartium-download]). Так вот, сгенерированный JavaScript для этого блога весит 207\ Кб (сравните с\ 8\ Кб
    минифицированного Dart-кода). А\ всё потому, что в\ js-файл компилятору приходится встраивать всю
    ту\ огромную прослойку для поддержки разницы в\ DOM и\ событиях между языками.

Я\ думаю, что Google не\ оставит своих планов выпустить nextgen язык для Web. Меня лично эти планы вполне устраивают,
так как я\ отлично представляю, чем этот язык будет лучше и\ удобнее. Как минимум он\ позволит выбросить весь тот
backward-compatibility хлам, который уже давно никто не\ использует, но\ который обязан присутствовать в\ каждом
браузере, потому что его могут использовать сайты, созданные 15\ лет назад.

И\ не\ надо говорить, что всякие надстройки используют те, кто не\ осилил выучить нативный JavaScript.

P.\ S. ~~К\ сожалению, нормальной поддержки подсветки Dart в\ блоге пока нет, но\ я\ надеюсь это в\ скором времени
исправить.~~ Исправил.

[Dart]: https://www.dartlang.org/
[Dartium]: https://www.dartlang.org/tools/dartium/
[dartium-download]: https://www.dartlang.org/tools/download.html
[factory]: https://www.dartlang.org/docs/dart-up-and-running/contents/ch02.html#ch02-constructor-factory
[Generics]: https://www.dartlang.org/docs/dart-up-and-running/contents/ch02.html#generics
[old-post]: /post/dart/
[webstorm]: http://www.jetbrains.com/webstorm/
